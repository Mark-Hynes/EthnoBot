@model IEnumerable<EthnoBot.Models.CartItem>
@{
    /**/

    ViewBag.Title = "Cart";
    int total = 0;
}

<h2>Cart</h2>


<ul class="list-group">
    @foreach (var item in Model)
    {
        total += (int)item.total;
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <span class=" text-info">@Html.ActionLink(item.product.Title, "ProductAndListings", "Categories", new { id = item.product.ProductId }, new { @class = "text-info", })</span>

            <span class=" text-info">@Html.ActionLink(item.producer.Name, "ProducerAndListings", "Categories", new { id = item.producer.ProducerId }, new { @class = "text-info", })</span>

            <span class="badge badge-primary badge-pill">$@item.unitPrice per Kg unit</span>
            <span class=" text-info"> @item.quantityKg Units</span>

            <span class=" text-info">Total: $ @item.total</span>
            <button type="button" class="btn btn-primary" data-toggle="modal" onclick="editItemPopup('@item.producer.ProducerId','@item.producer.Name','@item.unitPrice','@item.product.ProductId','@item.product.Title','@item.quantityKg')" data-target="#Modal">
                Edit Item
            </button>
            <button type="button" class="btn btn-primary" onclick="deleteItem('@item.producer.ProducerId','@item.producer.Name','@item.unitPrice','@item.product.ProductId','@item.product.Title','@item.quantityKg')" data-target="#Modal">
                Delete
            </button>

        </li>
    }
</ul>
<h4>Subtotal: $@total</h4>


    @Html.ActionLink("Checkout", "PaymentWithPaypal","Cart",null,new { type="button",@class="btn btn-primary"})


<div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add selected items to cart</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="Modal-ProductID"></p>
                <p id="Modal-Product"></p>
                <p id="Modal-Producer"></p>
                <p id="Modal-Price"></p>
                <div class="input-group mb-3">
                    <input type="number" id="KGUnits" class="form-control" min="1" max="100"  aria-label="KGUnits" aria-describedby="basic-addon2" required>
                    <div class="input-group-append">
                        <span class="input-group-text" id="basic-addon2"> kgs</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>

                <button type="button" id="SaveChanges" class="btn btn-secondary">Save Changes</button>
            </div>
        </div>
    </div>
</div>








<script type="text/javascript">
    var producerID = "";
    var productID = "";
    var unitPrice = "";
    var quantity = "";

    function editItemPopup(producerId, producerName, price, productId, productName, oldquantity) {

        productID = productId;
        producerID = producerId;
        unitPrice = price;
        quantity = oldquantity;
        document.getElementById("Modal-Producer").innerText = "Product Name: " + productName;
        document.getElementById("Modal-Producer").innerText = "Seller Name: " + producerName;


        document.getElementById("Modal-Price").innerText = "Price per 1kg: " + price;
        document.getElementById("KGUnits").setAttribute("placeholder",oldquantity);

    }
    function deleteItem(producerId, producerName, price, productId, productName, quantity) {
       location.href = '@Url.Action("RemoveFromBasket", "Cart")?producerId=' + producerId + '&productId=' + productId + '&quantity=' + quantity;

    }


    (function () {
        document.getElementById("SaveChanges").onclick = function () {
          var  newQuantity = document.getElementById("KGUnits").value

            location.href = '@Url.Action("EditItem", "Cart")?producerId=' + producerID + '&productId=' + productID + '&oldQuantity=' + quantity + "&newQuantity=" + newQuantity;

        };
    })();
</script>




